version: 3.3.0-{build}
image: Visual Studio 2015
branches:
  only:
  - master
skip_tags: true
environment:
  matrix:
  - Platform: net20
#  - Platform: net40
#  - Platform: net45
#  - Platform: sl5
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
    Platform: netstandard1.3
#  - Platform: monoandroid2.3
#  - Platform: xamarinios1.0
install:
- cmd: IF "%Platform%"=="monoandroid2.3" (powershell -File ./build/appveyor-install-android-sdk.ps1)
build_script:
- cmd: cd build && build-%Platform%.bat
test_script:
- cmd: IF "%Platform%"=="net20" (nunit-console .\src\Pkcs11Interop\Pkcs11InteropTests\bin\Release\Pkcs11InteropTests.dll && nunit-console-x86 .\src\Pkcs11Interop\Pkcs11InteropTests\bin\Release\Pkcs11InteropTests.dll)
- cmd: IF "%Platform%"=="netstandard1.3" (dotnet test .\src\Pkcs11Interop.NetStandard\Pkcs11Interop.DotNetCore.Tests\Pkcs11Interop.DotNetCore.Tests.csproj --configuration Release)
artifacts:
- path: build/$(Platform)
  name: $(Platform)